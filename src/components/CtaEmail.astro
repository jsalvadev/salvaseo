<div class='relative isolate overflow-hidden bg-warm-white py-16 sm:py-24 lg:py-32'>
  <div class='mx-auto max-w-7xl px-6 lg:px-8'>
    <div class='bg-white rounded-3xl shadow-2xl p-8 sm:p-12 lg:p-16'>
      <div
        class='mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:max-w-none lg:grid-cols-2'>
      <div class='max-w-xl lg:max-w-lg'>
        <h2
          class='text-4xl font-semibold tracking-tight text-petrol-900 text-pretty'>
          Empecemos por tu caso
        </h2>
        <p class='mt-4 text-lg text-petrol-900 text-pretty'>
          Deja tu email. Recibirás respuesta en menos de 24h con el análisis inicial de tu caso. <strong>Sin compromiso</strong>.
        </p>
        <form id='cta-email-form' class='mt-6 max-w-md'>
          <div class='flex gap-x-4'>
            <label
              for='email-address'
              class='sr-only'
              >Email address</label
            >
            <input
              id='email-address'
              type='email'
              name='email'
              required
              placeholder='Tu email de contacto'
              autocomplete='email'
              class='min-w-0 flex-auto rounded-md bg-white px-3.5 py-2 text-base text-petrol-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-sky-500 sm:text-sm/6'
            />
            <button
              type='submit'
              id='cta-submit-btn'
              class='flex-none rounded-md bg-sky-500 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-sky-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-500 disabled:opacity-50 disabled:cursor-not-allowed'
              >Analiza mi caso</button
            >
          </div>
          <div class='flex items-start gap-2 text-sm mt-3'>
            <input
              type='checkbox'
              id='cta-privacy-consent'
              name='privacyConsent'
              required
              class='mt-0.5'
            />
            <label for='cta-privacy-consent' class='text-petrol-900'>
              He leído y acepto la
              <a href='/politica-privacidad' class='text-orange-500 underline'>
                política de privacidad
              </a>
            </label>
          </div>
        </form>
        <div id='cta-form-message' class='mt-4 hidden'>
          <p class='text-sm'></p>
        </div>
      </div>
      <dl class='grid grid-cols-1 gap-x-8 gap-y-10 sm:grid-cols-2 lg:pt-2'>
        <div class='flex flex-col items-start'>
          <div class='rounded-md bg-white/50 p-2 ring-1 ring-gray-200'>
            <svg
              xmlns='http://www.w3.org/2000/svg'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='1.5'
              data-slot='icon'
              aria-hidden='true'
              class='size-6 text-petrol-900'>
              <path
                d='M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z'
                stroke-linecap='round'
                stroke-linejoin='round'
              ></path>
            </svg>
          </div>
          <dt class='mt-4 text-base font-semibold text-petrol-900'>
            Contacto personal
          </dt>
          <dd class='mt-2 text-base/7 text-petrol-900'>
            Respuesta personal directa. Nada de respuestas automáticas.
          </dd>
        </div>
        <div class='flex flex-col items-start'>
          <div class='rounded-md bg-white/50 p-2 ring-1 ring-gray-200'>
            <svg
              xmlns='http://www.w3.org/2000/svg'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='1.5'
              data-slot='icon'
              aria-hidden='true'
              class='size-6 text-petrol-900'>
              <path
                d='M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z'
                stroke-linecap='round'
                stroke-linejoin='round'
              ></path>
            </svg>
          </div>
          <dt class='mt-4 text-base font-semibold text-petrol-900'>Cero spam</dt>
          <dd class='mt-2 text-base/7 text-petrol-900'>
            Un email para ver si tiene sentido hablar. Si no encaja, sin problema.
          </dd>
        </div>
      </dl>
      </div>
    </div>
  </div>
  <div
    aria-hidden='true'
    class='absolute top-0 left-1/2 -z-10 -translate-x-1/2 blur-3xl xl:-top-6'>
    <div
      style='clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)'
      class='aspect-1155/678 w-288.75 bg-linear-to-tr from-sky-300 to-sky-500 opacity-30'>
    </div>
  </div>
</div>

<script>
  const ctaForm = document.getElementById('cta-email-form') as HTMLFormElement;
  const ctaSubmitBtn = document.getElementById('cta-submit-btn') as HTMLButtonElement;
  const ctaMessageDiv = document.getElementById('cta-form-message') as HTMLDivElement;
  const ctaMessageP = ctaMessageDiv.querySelector('p') as HTMLParagraphElement;

  ctaForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    ctaSubmitBtn.disabled = true;
    ctaSubmitBtn.textContent = 'Enviando...';
    ctaMessageDiv.classList.add('hidden');

    try {
      const formData = new FormData(ctaForm);
      const response = await fetch('/api/send-cta-email', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error || 'Error al enviar el email');
      }

      ctaMessageP.textContent = '¡Email enviado! Te contactaré pronto.';
      ctaMessageP.className = 'text-sm text-green-600';
      ctaForm.reset();
    } catch (error) {
      ctaMessageP.textContent = error instanceof Error ? error.message : 'Error al enviar el email. Inténtalo de nuevo.';
      ctaMessageP.className = 'text-sm text-red-600';
    }

    ctaSubmitBtn.disabled = false;
    ctaSubmitBtn.textContent = 'Analiza mi caso';
    ctaMessageDiv.classList.remove('hidden');
  });
</script>