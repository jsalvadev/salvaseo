<div id='contacto' class='relative isolate bg-white px-6 py-12 sm:py-16 lg:px-8'>
  <svg
    aria-hidden='true'
    class='absolute inset-0 -z-10 size-full mask-[radial-gradient(100%_100%_at_top_right,white,transparent)] stroke-gray-200'>
    <defs>
      <pattern
        id='83fd4e5a-9d52-42fc-97b6-718e5d7ee527'
        width='200'
        height='200'
        x='50%'
        y='-64'
        patternUnits='userSpaceOnUse'>
        <path
          d='M100 200V.5M.5 .5H200'
          fill='none'
        ></path>
      </pattern>
    </defs>
    <svg
      x='50%'
      y='-64'
      class='overflow-visible fill-gray-50'>
      <path
        d='M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M299.5 800h201v201h-201Z'
        stroke-width='0'
      ></path>
    </svg>
    <rect
      width='100%'
      height='100%'
      fill='url(#83fd4e5a-9d52-42fc-97b6-718e5d7ee527)'
      stroke-width='0'
    ></rect>
  </svg>
  <div class='mx-auto max-w-lg lg:max-w-2xl'>
    <h2
      class='text-3xl font-semibold tracking-tight text-pretty text-petrol-900 sm:text-4xl'>
      Cuéntame qué necesitas
    </h2>
    <p class='mt-2 text-lg/8 text-petrol-900'>
      Explícame tu situación y qué te gustaría conseguir. <strong>Sin compromiso, sin
      presión.</strong> Solo una conversación para ver si tiene sentido trabajar juntos.
    </p>
    <div class='mt-8 flex flex-col gap-16 sm:gap-y-20 lg:flex-row'>
      <form
        id='contact-form'
        class='lg:flex-auto'>
        <div class='grid grid-cols-1 gap-x-6 gap-y-4'>
          <div>
            <label
              for='name'
              class='block text-sm/6 font-semibold text-petrol-900'
              >Nombre (opcional)</label
            >
            <div class='mt-1.5'>
              <input
                id='name'
                type='text'
                name='name'
                autocomplete='name'
                placeholder='Cómo te llamas'
                class='block w-full rounded-md bg-white px-3 py-1.5 text-base text-petrol-900 outline-1 -outline-offset-1 outline-gray-300 backdrop-blur-sm placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-amber-600'
              />
            </div>
          </div>
          <div>
            <label
              for='email'
              class='block text-sm/6 font-semibold text-petrol-900'
              >Email *</label
            >
            <div class='mt-1.5'>
              <input
                id='email'
                type='email'
                name='email'
                autocomplete='email'
                required
                placeholder='tu@email.com'
                class='block w-full rounded-md bg-white px-3 py-1.5 text-base text-petrol-900 outline-1 -outline-offset-1 outline-gray-300 backdrop-blur-sm placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-amber-600'
              />
            </div>
          </div>
          <div>
            <label
              for='message'
              class='block text-sm/6 font-semibold text-petrol-900'
              >Mensaje *</label
            >
            <div class='mt-1.5'>
              <textarea
                id='message'
                name='message'
                rows='4'
                required
                placeholder='Tu negocio, tu zona, qué te preocupa…'
                class='block w-full rounded-md bg-white px-3 py-1.5 text-base text-petrol-900 outline-1 -outline-offset-1 outline-gray-300 backdrop-blur-sm placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-amber-600'
              ></textarea>
            </div>
          </div>
        </div>
        <div class='mt-6'>
          <button
            type='submit'
            id='submit-btn'
            class='block w-full rounded-md bg-amber-600 px-3.5 py-2.5 text-center text-sm font-semibold text-white shadow-xs hover:bg-amber-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-600 disabled:opacity-50 disabled:cursor-not-allowed'
            >Hablemos de tu negocio</button
          >
        </div>
        <div id='form-message' class='mt-4 hidden'>
          <p class='text-sm'></p>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const messageDiv = document.getElementById('form-message') as HTMLDivElement;
  const messageP = messageDiv.querySelector('p') as HTMLParagraphElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = {
      name: formData.get('name'),
      email: formData.get('email'),
      message: formData.get('message'),
    };

    submitBtn.disabled = true;
    submitBtn.textContent = 'Enviando...';
    messageDiv.classList.add('hidden');

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        messageP.textContent = '¡Mensaje enviado correctamente! Te responderé pronto.';
        messageP.className = 'text-sm text-green-600';
        form.reset();
      } else {
        messageP.textContent = result.error || 'Error al enviar el mensaje. Inténtalo de nuevo.';
        messageP.className = 'text-sm text-red-600';
      }
    } catch (error) {
      messageP.textContent = 'Error de conexión. Por favor, inténtalo más tarde.';
      messageP.className = 'text-sm text-red-600';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Hablemos de tu negocio';
      messageDiv.classList.remove('hidden');
    }
  });
</script>